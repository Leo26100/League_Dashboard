---
title: "Bot Lane Analysis"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(fig.width=15, fig.height=8)

#Source_Code_Dataframes brings the Picks_df and Bans_df that are going to be used in this R Markdown
source("Source_Code_Dataframes.R")

Favorite_theme  <- theme(axis.title = element_blank(),
        panel.grid.major.x = element_blank(),
        panel.grid.minor = element_blank(),
        legend.position = c(1,1), legend.justification = c(1,1),
        legend.background = element_blank(),
        legend.direction="horizontal",
        legend.title = element_blank(),
        axis.text.x = element_text(face= 'bold', size = 10))

Team_Names_Axis <- scale_x_discrete(labels=c("FunPlus Phoenix" = "FPX", "G2 Esports" = "G2", "SK Telecom T1" = "SKT", "Invictus Gaming" = "IG","DAMWON Gaming" = "DWG", "Splyce" =  "SPY", "Fnatic" = "FNC", "Griffin" = "GRF", "Team Liquid" = "TL", "ahq eSports Club" = "AHQ","Royal Never Give Up" = "RNG", "Clutch Gaming" = "CG", "Hong Kong Attitude" = "HKA", "Cloud9" = "C9", "J Team" = "JT", "GAM Esports" = "GAM"))

#Factors make it easy to add levels to variables!!
Picks_df <- Picks_df %>%
  mutate(Phase=as.factor(Phase), Side=as.factor(Side),Order=as.factor(Order),
         Champions=as.factor(Champions), Role=as.factor(Role), Team=as.factor(Team))

Bans_df %>%
    mutate(Phase=as.factor(Phase), Side=as.factor(Side),Order=as.factor(Order),
         Champions=as.factor(Champions), Team=as.factor(Team))

#Counts of the champions picked by team
Team_count_df <- Picks_df %>%
  group_by(Role, Team)%>%
  count(Champions) %>%
  ungroup()%>%
  count(Team)

Team_count_bot_df <- Picks_df %>%
  group_by(Role, Team)%>%
  filter(Role == 'Bot Laner') %>% 
  count(Champions) %>%
  ungroup()%>%
  count(Team)
#Count of champions picked by Role
Picks_count_df <- Picks_df%>%
  group_by(Champions,Role)%>%
  count(Champions)
# I am categorizing common picks as a champion that was picked at least 3 times by one or more teams
# Going to be using this data frame as a filter to only include champions that made it past these parameters
Picks_common_df <- Picks_df%>%
  group_by(Champions,Role, Team)%>%
  count(Champions) %>%
  filter(n > 2) %>%
  ungroup()%>%
  group_by(Champions,Role) %>%
  summarise(total = sum(n))

Picks_common_bot_df <- Picks_common_df %>%
  filter(Role == 'Bot Laner')

Bans_count_df <- Bans_df  %>%
    group_by(Champions)%>%
  count(Champions)

```

## Bot Lane Analysis

Lets start out and see how many unique champions where picked by each Team

```{r echo=FALSE}
# Unique Picks Per Team
Champions <- 145 
Picks_df %>%
  group_by(Role, Team)%>%
  count(Champions) %>%
  ggplot()+
  geom_bar(mapping = aes(x = Team, fill = Role))   +
  geom_text(data = Team_count_df, aes(x = Team, y = n,label = n),
            position = position_dodge(width = 1),
            vjust = -1) +
  labs(title = "Unique Champions Picked by Team per Role",
       subtitle ="Number of top is the total champions picked by the team. The bar are separeted by color per role and legend is on the top right") +
  theme_minimal()+
  scale_y_continuous() +
  Favorite_theme +
  Team_Names_Axis

Picks_df %>%
  group_by(Role, Team) %>%
  count(Champions)
```
There are at total of 145 champions at the time worlds started with Qiyana being released
```{r echo = FALSE}
#Unique Bot Champions per Team 
Picks_df %>%
  group_by(Role, Team)%>%
  filter(Role == 'Bot Laner') %>%
  count(Champions) %>%
  ggplot()+
  geom_bar(mapping = aes(x = Team, fill = Role))   +
  geom_text(data = Team_count_bot_df, aes(x = Team, y = n,label = n),
            position = position_dodge(width = 1),
            vjust = -1) +
  labs(title = "Unique Bot Lane Champions Picked by Team") +
  theme_minimal()+
  scale_y_continuous() +
  Favorite_theme +
  Team_Names_Axis
```
# Bot Picks


```{r echo=FALSE}
#Bot Lane Champions Count
# Keeps champions that were picked 3 times or more
Picks_bot_count_df<- Picks_count_df %>%  
  filter(Role == 'Bot Laner') %>%
  filter(n > 2)

Picks_bot_count_df %>%
ggplot(aes(x = Champions, y = n, fill = Champions))+
  geom_bar(stat = 'identity') +
  geom_text(aes(label = n),
            position = position_dodge(width = 1),
            vjust = -1)  
```
# Common Bot lane picks
Basically Kai'sa vs Xayah

```{r echo=FALSE}
Picks_bot_count_df %>%
  filter(Champions %in% Picks_common_bot_df$Champions) %>%
  ggplot(aes(x = Champions, y = n, fill = Champions))+
  geom_bar(stat = 'identity') +
  geom_text(aes(label = n),
            position = position_dodge(width = 1),
            vjust = -1)
```
Lets see if Bans reflect how often the champions were picked
```{r, echo = FALSE}
Bans_count_df %>%
  filter(Champions %in% Picks_common_bot_df$Champions) %>%
ggplot(aes(x = Champions, y = n, fill = Champions))+
  geom_bar(stat = 'identity') +
  geom_text(aes(label = n),
            position = position_dodge(width = 1),
            vjust = -1)
```
They do cause Kai'sai is more popular than Xayah but thats because Xayah is ban more often.
There for Xayah is stronger?

# Frequency of the picks between Groups and Knockout
But did the frequency changed the group stage and the Knockout stage
```{r}
Picks_df %>%
  group_by(Role, Stage) %>%
  filter(Champions %in% Picks_common_bot_df$Champions)%>%
  count(Champions) %>%
  filter(Role == 'Bot Laner')%>%
  ggplot(mapping = aes(x = Champions, y = n, fill = Stage))+
  geom_bar(position = 'dodge', stat = 'identity')
```
Nah but same thing could be said about bans too
```{r}
Bans_df %>%
  group_by(Stage) %>%
  filter(Champions %in% Picks_common_bot_df$Champions)%>%
  count(Champions) %>%
  ggplot(mapping = aes(x = Champions, y = n, fill = Stage))+
  geom_bar(position = 'dodge', stat = 'identity')
```
# Looking throughout the Worlds 2019
```{r warning=FALSE}
Picks_popular_bot_df<- head(arrange(Picks_common_bot_df,desc(total)),n = 2)

Picks_bot_phase_count<- Picks_df %>%
  group_by(Role, Phase) %>%
  filter(Champions %in% Picks_common_bot_df$Champions)%>%
  count(Champions) %>%
  filter(Role == 'Bot Laner')

Bans_bot_common_phase_count<- Bans_df %>%
  group_by(Phase)%>%
  filter(Champions %in% Picks_common_bot_df$Champions)%>%
  count(Champions)
Picks_bot_phase_count$Phase <- factor(Picks_bot_phase_count$Phase, levels = c('Day 1','Day 2','Day 3','Day 4','Day 5',
                                                                              'Day 6','Day 7','Day 8','Tiebreakers',
                                                                              'Quarterfinals','Semifinals','Finals'))
Bans_bot_common_phase_count$Phase <- factor(Bans_bot_common_phase_count$Phase, levels = c('Day 1','Day 2','Day 3','Day 4',
                                                                                    'Day 5','Day 6','Day 7','Day 8',
                                                                                    'Tiebreakers','Quarterfinals',
                                                                                    'Semifinals','Finals'))

Picks_bot_phase_count <- Picks_bot_phase_count%>%
  left_join(Bans_bot_common_phase_count, by = c('Champions','Phase'))


Picks_bot_phase_count[is.na(Picks_bot_phase_count)] <- 0

Picks_bot_phase_count%>%
  filter(Champions %in% Picks_popular_bot_df$Champions)%>%
  mutate(Pick_prio = n.x + n.y) %>%
  ggplot(mapping = aes(x = Phase, y = Pick_prio, color = Champions, group = Champions))+
  geom_line()+
  geom_smooth(method = 'loess', se = FALSE, span = 0.6) +
  theme_classic()
  #stat_smooth(aes(y = n.x)) +
  #geom_text(aes(label = Champions, y = n.x),
   #         position = position_dodge(width = 1),
    #        vjust = -1) +
  #geom_point(aes(y = n.x, color = n.x)) +
# geom_smooth(aes(y = n.x))+
  #facet_grid(~Champions)
```
